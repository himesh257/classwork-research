> #performs LASSO on binomial variables#       
> #--------------------------------------------------------------------------------------------------------#
> library(faraway)
> data(prostate,package="faraway")
> head(prostate)
      lcavol lweight age      lbph svi      lcp gleason pgg45     lpsa
1 -0.5798185  2.7695  50 -1.386294   0 -1.38629       6     0 -0.43078
2 -0.9942523  3.3196  58 -1.386294   0 -1.38629       6     0 -0.16252
3 -0.5108256  2.6912  74 -1.386294   0 -1.38629       7    20 -0.16252
4 -1.2039728  3.2828  58 -1.386294   0 -1.38629       6     0 -0.16252
5  0.7514161  3.4324  62 -1.386294   0 -1.38629       6     0  0.37156
6 -1.0498221  3.2288  50 -1.386294   0 -1.38629       6     0  0.76547
> 
> #save graph in pdf
>  pdf(file="C:/Users/jmard/OneDrive/Desktop/RegressionMethodsSpring2020/Ridge_Lasso/Lasso_prostate_binary_Figure.pdf")
> 
> library(glmnet) # include glmnet library including functions for finding the lasso
Loading required package: Matrix
Loaded glmnet 3.0-2

Warning message:
package ‘glmnet’ was built under R version 3.6.3 
> 
> #perform binary LASSO regression#
> 
> x<-(apply(prostate[,-5],2,as.numeric))
> #svi (0,1) is seminal vesicle invasion and is found in the 5th column
> 
> head(x) 
         lcavol lweight age      lbph      lcp gleason pgg45     lpsa
[1,] -0.5798185  2.7695  50 -1.386294 -1.38629       6     0 -0.43078
[2,] -0.9942523  3.3196  58 -1.386294 -1.38629       6     0 -0.16252
[3,] -0.5108256  2.6912  74 -1.386294 -1.38629       7    20 -0.16252
[4,] -1.2039728  3.2828  58 -1.386294 -1.38629       6     0 -0.16252
[5,]  0.7514161  3.4324  62 -1.386294 -1.38629       6     0  0.37156
[6,] -1.0498221  3.2288  50 -1.386294 -1.38629       6     0  0.76547
> #-----------------------------------------------------------------#
> 
> y<-(prostate[,5])  #svi (0,1) is found in the 5th column
> head(y)
[1] 0 0 0 0 0 0
> 
> lassofit<-glmnet(x,y,family=c("binomial"))  #fits a logistic regression model
> 
> print(lassofit) # DF gives the number of non-zero coefficients

Call:  glmnet(x = x, y = y, family = c("binomial")) 

   Df    %Dev   Lambda
1   0 0.00000 0.277200
2   1 0.07183 0.252600
3   1 0.12950 0.230200
4   1 0.17690 0.209700
5   1 0.21630 0.191100
6   2 0.25280 0.174100
7   2 0.29090 0.158600
8   2 0.32420 0.144500
9   2 0.35360 0.131700
10  2 0.37960 0.120000
11  2 0.40280 0.109300
12  2 0.42370 0.099630
13  2 0.44250 0.090780
14  2 0.45940 0.082710
15  2 0.47470 0.075370
16  2 0.48860 0.068670
17  2 0.50120 0.062570
18  2 0.51260 0.057010
19  2 0.52290 0.051950
20  2 0.53230 0.047330
21  2 0.54080 0.043130
22  2 0.54850 0.039300
23  2 0.55540 0.035800
24  2 0.56160 0.032620
25  2 0.56720 0.029730
26  2 0.57220 0.027090
27  3 0.57710 0.024680
28  3 0.58180 0.022490
29  4 0.58730 0.020490
30  4 0.59210 0.018670
31  4 0.59640 0.017010
32  4 0.60010 0.015500
33  4 0.60340 0.014120
34  4 0.60620 0.012870
35  4 0.60870 0.011720
36  4 0.61090 0.010680
37  4 0.61280 0.009734
38  4 0.61440 0.008869
39  4 0.61580 0.008081
40  4 0.61700 0.007363
41  4 0.61810 0.006709
42  4 0.61900 0.006113
43  5 0.62000 0.005570
44  5 0.62090 0.005075
45  5 0.62170 0.004624
46  5 0.62230 0.004214
47  5 0.62290 0.003839
48  5 0.62340 0.003498
49  5 0.62380 0.003187
50  6 0.62420 0.002904
51  6 0.62460 0.002646
52  6 0.62500 0.002411
53  7 0.62540 0.002197
54  7 0.62570 0.002002
55  7 0.62600 0.001824
56  7 0.62620 0.001662
57  7 0.62640 0.001514
58  7 0.62660 0.001380
59  7 0.62670 0.001257
60  8 0.62690 0.001145
61  8 0.62710 0.001044
62  8 0.62720 0.000951
63  8 0.62730 0.000866
64  8 0.62740 0.000790
65  8 0.62750 0.000719
66  8 0.62750 0.000656
67  8 0.62760 0.000597
68  8 0.62760 0.000544
69  8 0.62770 0.000496
70  8 0.62770 0.000452
71  8 0.62770 0.000412
72  8 0.62770 0.000375
73  8 0.62780 0.000342
74  8 0.62780 0.000311
75  8 0.62780 0.000284
> 
> par(mfrow = c(1, 1))
> 
> plot(lassofit, xvar="lambda")
> #-----------------------------------------------------------------#
> 
> #plot(lassofit, xvar="norm")
> #-----------------------------------------------------------------#
> 
> par(mfrow = c(1, 1))
> coef(lassofit)
9 x 75 sparse Matrix of class "dgCMatrix"
   [[ suppressing 75 column names ‘s0’, ‘s1’, ‘s2’ ... ]]
                                                                                                                                                                                 
(Intercept) -1.286211 -1.2736209 -1.2718264 -1.2774879 -1.2885070 -1.35099871 -1.51968768 -1.6888844 -1.8590395 -2.0306253 -2.2039438 -2.3791913 -2.5564734 -2.7358151 -2.9171680
lcavol       .         .          .          .          .          .           .           .          .          .          .          .          .          .          .        
lweight      .         .          .          .          .          .           .           .          .          .          .          .          .          .          .        
age          .         .          .          .          .          .           .           .          .          .          .          .          .          .          .        
lbph         .         .          .          .          .          .           .           .          .          .          .          .          .          .          .        
lcp          .         0.1018029  0.1915754  0.2724387  0.3463919  0.40638399  0.44417993  0.4794435  0.5127048  0.5442699  0.5744054  0.6033249  0.6312025  0.6581809  0.6843778
gleason      .         .          .          .          .          .           .           .          .          .          .          .          .          .          .        
pgg45        .         .          .          .          .          .           .           .          .          .          .          .          .          .          .        
lpsa         .         .          .          .          .          0.01854596  0.07697983  0.1341769  0.1905650  0.2465242  0.3023200  0.3581442  0.4141303  0.4703636  0.5268893
                                                                                                                                                                                      
(Intercept) -3.1004141 -3.2853689 -3.4717845 -3.6593522 -3.8477069 -4.0364326 -4.2249590 -4.4129949 -4.5999261 -4.7852169 -4.968327 -5.143264411 -5.30751573 -5.719612381 -6.135478705
lcavol       .          .          .          .          .          .          .          .          .          .          .         .            .           .            .          
lweight      .          .          .          .          .          .          .          .          .          .          .         .            .           .            .          
age          .          .          .          .          .          .          .          .          .          .          .         .            .           0.003926221  0.007958765
lbph         .          .          .          .          .          .          .          .          .          .          .        -0.006303857 -0.02083079 -0.038672875 -0.055666788
lcp          0.7098908  0.7348001  0.7591710  0.7830554  0.8064929  0.8295120  0.8521545  0.8743760  0.8962042  0.9176306  0.938640  0.958679276  0.97770778  0.993725397  1.009496965
gleason      .          .          .          .          .          .          .          .          .          .          .         .            .           .            .          
pgg45        .          .          .          .          .          .          .          .          .          .          .         .            .           .            .          
lpsa         0.5837172  0.6408255  0.6981648  0.7556600  0.8132140  0.8707108  0.9279760  0.9849463  1.0414319  1.0972767  1.152324  1.205330615  1.25568737  1.303528356  1.350081729
                                                                                                                                                                                  
(Intercept) -6.53417342 -6.9118102 -7.27683395 -7.62543803 -7.95769648 -8.27382293 -8.57406151 -8.85868807 -9.12801330 -9.38238423 -9.62218412 -9.8478309 -9.97089600 -10.06314802
lcavol       .           .          .           .           .           .           .           .           .           .           .           .          .            .         
lweight      .           .          .           .           .           .           .           .           .           .           .           .          .            .         
age          0.01177733  0.0153723  0.01878976  0.02201884  0.02506652  0.02793972  0.03064514  0.03318933  0.03557874  0.03781976  0.03991872  0.0418819  0.04406754   0.04621034
lbph        -0.07154183 -0.0864366 -0.10028168 -0.11320722 -0.12527106 -0.13652410 -0.14701368 -0.15678418 -0.16587746 -0.17433316 -0.18218895 -0.1894807 -0.19601153  -0.20202323
lcp          1.02517137  1.0403390  1.05560717  1.07058365  1.08520330  1.09941817  1.11318746  1.12647705  1.13925929  1.15151285  1.16322232  1.1743779  1.18988564   1.20579437
gleason      .           .          .           .           .           .           .           .           .           .           .           .         -0.01630487  -0.03589509
pgg45        .           .          .           .           .           .           .           .           .           .           .           .          .            .         
lpsa         1.39536134  1.4384587  1.48099782  1.52210929  1.56171121  1.59976119  1.63622689  1.67108551  1.70432399  1.73593903  1.76593682  1.7943326  1.82142495   1.84694464
                                                                                                                                                                                         
(Intercept) -10.15160491 -10.23592869 -10.31604786 -10.39194280 -10.46363330 -10.515459491 -10.48211977 -10.45558019 -1.046838e+01 -1.050839e+01 -10.54579675 -10.581172258 -10.614539549
lcavol        .            .            .            .            .            .             .            .           .             .              .            .             .          
lweight       .            .            .            .            .           -0.006512721  -0.04207236  -0.07463627 -1.063438e-01 -1.359874e-01  -0.16326092  -0.188372124  -0.211472141
age           0.04821672   0.05009237   0.05184347   0.05347616   0.05499644   0.056574894   0.05879237   0.06084079  6.285883e-02  6.475993e-02   0.06651863   0.068142883   0.069641506
lbph         -0.20761100  -0.21280271  -0.21762255  -0.22209337  -0.22623679  -0.229583057  -0.23049055  -0.23135253 -2.312661e-01 -2.306851e-01  -0.23017065  -0.229700686  -0.229271865
lcp           1.22086082   1.23507542   1.24845638   1.26102603   1.27280981   1.283771021   1.29406491   1.30369782  1.315282e+00  1.327612e+00   1.33904259   1.349675502   1.359550387
gleason      -0.05410112  -0.07100323  -0.08668139  -0.10121155  -0.11466591  -0.127721894  -0.14331349  -0.15755652 -1.658125e-01 -1.697590e-01  -0.17356356  -0.177069906  -0.180297365
pgg45         .            .            .            .            .            .             .            .          -2.834333e-04 -7.143524e-04  -0.00110723  -0.001469696  -0.001803827
lpsa          1.87112537   1.89393046   1.91538980   1.93554055   1.95442471   1.972749903   1.99086331   2.00821645  2.027236e+00  2.046797e+00   2.06510506   2.082135830   2.097954715
                                                                                                                                                                                   
(Intercept) -10.643276270 -10.672744303 -10.734168532 -10.794352774 -10.842996111 -10.894950297 -10.937992324 -10.980117844 -11.019132129 -11.052331858 -11.085124655 -11.112848236
lcavol        .             .            -0.013063796  -0.025254239  -0.036344382  -0.046572414  -0.055712596  -0.064364740  -0.072300138  -0.079238706  -0.085856095  -0.091605076
lweight      -0.232660141  -0.252165764  -0.263308851  -0.273253965  -0.282630817  -0.290941603  -0.298724636  -0.305774720  -0.312219770  -0.318185392  -0.323577724  -0.328566962
age           0.071019759   0.072292023   0.073601576   0.074825734   0.075940315   0.076975226   0.077914826   0.078785417   0.079584823   0.080307872   0.080978489   0.081583808
lbph         -0.228907408  -0.228550602  -0.229834945  -0.231059888  -0.232188086  -0.233219269  -0.234153751  -0.235028443  -0.235830822  -0.236545473  -0.237216977  -0.237812842
lcp           1.368565063   1.377045254   1.388563286   1.399385615   1.409064832   1.418248371   1.426420217   1.434134043   1.441232513   1.447509572   1.453463463   1.458702207
gleason      -0.183495767  -0.186219025  -0.187802682  -0.189353756  -0.191175351  -0.192491214  -0.193973449  -0.195209693  -0.196342571  -0.197533543  -0.198505886  -0.199535945
pgg45        -0.002103963  -0.002387293  -0.002671938  -0.002928267  -0.003154218  -0.003368663  -0.003557224  -0.003734872  -0.003897508  -0.004039912  -0.004175107  -0.004292764
lpsa          2.112258891   2.125849747   2.144278464   2.161823040   2.177090657   2.192059547   2.205135863   2.217582159   2.229058254   2.239129280   2.248763497   2.257182532
                                                                                              
(Intercept) -11.14052512 -11.163670339 -11.186971764 -11.203890213 -11.225099489 -11.235431912
lcavol       -0.09713652  -0.101897733  -0.106517497  -0.110124503  -0.114227435  -0.116576307
lweight      -0.33307061  -0.337232895  -0.340992384  -0.344449464  -0.347612123  -0.350247176
age           0.08214616   0.082652187   0.083123102   0.083534614   0.083936642   0.084251232
lbph         -0.23837510  -0.238872173  -0.239342259  -0.239745110  -0.240144444  -0.240477297
lcp           1.46370237   1.468067523   1.472260445   1.475627701   1.479337797   1.481543186
gleason      -0.20035740  -0.201244326  -0.201935734  -0.202859789  -0.203318931  -0.204376515
pgg45        -0.00440549  -0.004502586  -0.004596567  -0.004668733  -0.004753196  -0.004794933
lpsa          2.26528548   2.272317983   2.279119980   2.284564347   2.290559641   2.294340434
> 
> # Cross Validation
> cvlassofit <- cv.glmnet(x,y)
> print(cvlassofit)

Call:  cv.glmnet(x = x, y = y) 

Measure: Mean-Squared Error 

     Lambda Measure      SE Nonzero
min 0.02468 0.09684 0.01605       3
1se 0.09963 0.11027 0.02237       2
> plot(cvlassofit)
> 
> coef(cvlassofit, s = "lambda.min") # to get the coefficients for the "optimal" lambda
9 x 1 sparse Matrix of class "dgCMatrix"
                      1
(Intercept)  0.01122030
lcavol       .         
lweight      .         
age          .         
lbph        -0.01986148
lcp          0.13896643
gleason      .         
pgg45        .         
lpsa         0.09368726
> 
> #choose the largest value of lambda which is within 1 SE of the minimum
> coef(cvlassofit, s = "lambda.1se") # to get the coefficients for the one SE lambda
9 x 1 sparse Matrix of class "dgCMatrix"
                     1
(Intercept) 0.12424549
lcavol      .         
lweight     .         
age         .         
lbph        .         
lcp         0.10729447
gleason     .         
pgg45       .         
lpsa        0.04498655
> 
> dev.off()
null device 
          1 
> 
