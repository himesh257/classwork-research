---
title: "Quiz 6"
author: "Himesh Buch"
output: html_notebook
---

## Intro

This quiz is open everything, including notes, textbook, and whatever you might find on the internet. However, no interaction with other people is allowed. You have until noon EDT on October 14 to finish the quiz; there is no other time restriction. However, your file must be submitted on Canvas by the deadline; allow yourself time to download the file from RStudio Cloud to your computer and to submit it via Canvas.



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(rstanarm)
library(bayesplot)
library(bayestestR)
library(parameters)
library(knitr)
library(magrittr)
library(stableGR)
```


For this quiz, we will use an artificial data set.


```{r get data}
quiz_data <- read_csv("quiz.csv")
```

## First model

First, please fit a Bayesian linear model where `var1` is the outcome, with `var2` and `var3` as the predictor variables with no interaction.

```{r first model}
model1 <- stan_glm( var1 ~ var2 + var3 , data = quiz_data, iter = 4000)
```

Let's take a look at the trace plots.

```{r trace}
plot(model1, plotfun = "trace")

```

There are several ways to get 90% credible intervals. Use your favorite way to get 90% credible intervals of the parameters `(Intercept)`, `var2`, and `var3` in `model1`. (It doesn't matter whether you get highest density intervals or equal tails intervals.)  It is fine if the output produces additional information as long as the output explicitly shows a 90% credible intervals.

```{r credible intervals}
model_parameters(model1, centrality = "mean", ci = .9)
```

## Model 2

For the second model, please fit a model where: `var5` is the outcome,  `var6` is the predictor variable, and there are separate intercepts (but not slopes) for each group as defined by `group_var`.

```{r model 2}
model2 <- stan_glmer( var5 ~ var6 + (var6 | group_var), data = quiz_data, adapt_delta = 0.99, iter = 8000, cores = 4)
```

Please generate the posterior predictive check plot for `model2`.

```{r posterior predictive check}
pp_check(model2)
```

There are several ways to get the mean of the posterior for the regression coefficient of `var6`. Use your favorite way to do so. It is fine if the output produces additional information as long as the output explicitly shows the means.

```{r mean for var6 coef}
summary(model2)
```

A quick look at the densities of three of the parameters (nothing for you to do here).

```{r var6 coef density}
plot(model2, plotfun = "dens", pars = c("(Intercept)", "var6", "sigma"))
```

What is the probability that the `var6` coefficient is greater than 7.5?

```{r prob calc}
# to get the proper name of var6 we use the below code
# model2 %>%
#   as.data.frame() %>%
#   names()

# the name obtained from the above code is used here
model2 %>%
  as.data.frame() %$%
  mean(`var6` > 7.5)
```

Before you submit your file, be sure to choose "Run All" from the menu at the top right of the panel to make sure your entire file runs without errors. 
Finally, type your name below the pledge below to electronically sign it.

On my honor, I have neither received nor given any unauthorized assistance on this quiz.
Himesh Buch